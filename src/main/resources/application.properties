# ============================================
# APPLICATION CONFIGURATION
# ============================================
spring.application.name=pain_helper_back
server.port=8080

# ============================================
# DATABASE CONFIGURATION - PostgreSQL
# ============================================
# Main business database (patients, recommendations, escalations, etc.)
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/pain_management_db}
spring.datasource.username=${DB_USER:postgres}
spring.datasource.password=${DB_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate Configuration
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true

# Connection Pool (HikariCP)
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.maximum-pool-size=5

# Liquibase (disabled - using Hibernate DDL)
spring.liquibase.enabled=false

# ============================================
# JWT CONFIGURATION
# ============================================
# CRITICAL: Must match Authentication Service secret!
jwt.secret=${JWT_SECRET}

# ============================================
# MONGODB CONFIGURATION
# ============================================
# Used for performance monitoring and backups (analytics moved to microservice)
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration
spring.data.mongodb.repositories.enabled=false
spring.data.mongodb.auto-index-creation=true

app.mongodb.performance.uri=${MONGODB_PERFORMANCE_URI}
app.mongodb.backup.uri=${MONGODB_BACKUP_URI}
app.mongodb.performance.database=performance_db
app.mongodb.backup.database=backup_db

# ============================================
# KAFKA CONFIGURATION
# ============================================
# Used for event streaming to Analytics-Reporting microservice
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3

# ============================================
# ANALYTICS/REPORTING INTEGRATION
# ============================================
# Kafka topic to publish analytics events to (consumed by Analytics-Reporting microservice)
kafka.topic.analytics-events=${KAFKA_TOPIC_ANALYTICS_EVENTS:analytics-events}
# Base URL of Analytics Reporting microservice (used for REST fallback)
analytics.reporting.base-url=${ANALYTICS_REPORTING_BASE_URL:http://localhost:8091}

# ============================================
# ASYNC CONFIGURATION
# ============================================
spring.task.execution.pool.core-size=5
# ============================================
# PERFORMANCE SLA MONITORING
# ============================================
performance.sla.enabled=true
performance.sla.async-recording=true

# ============================================
# BACKUP CONFIGURATION
# ============================================
backup.postgres.directory=./backups/postgres
backup.mongo.directory=./backups/mongodb

backup.retention.days=30
backup.mongo.mongodump.path=mongodump
backup.mongo.mongorestore.path=mongorestore

# ============================================
# FHIR SERVER CONFIGURATION
# ============================================
# External EMR integration via FHIR R4
fhir.server.url=http://hapi.fhir.org/baseR4
fhir.connection.timeout=30000
fhir.socket.timeout=30000

# ============================================
# EMAIL CONFIGURATION (Spring Mail)
# ============================================
# For notifications and alerts
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=your-email@gmail.com
spring.mail.password=your-app-password
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000

# Alternative: Mailtrap for testing (https://mailtrap.io/)
# spring.mail.host=sandbox.smtp.mailtrap.io
# spring.mail.port=2525
# spring.mail.username=your-mailtrap-username
# spring.mail.password=your-mailtrap-password

# ============================================
# PAIN ESCALATION CONFIGURATION (Optional)
# ============================================
# Uncomment to customize escalation thresholds
#pain.escalation.min-vas-increase=2
#pain.escalation.min-dose-interval-hours=4
#pain.escalation.critical-vas-level=8
#pain.escalation.high-vas-level=6
#pain.escalation.trend-analysis-period-hours=24
#pain.escalation.max-escalations-per-period=3
# ============================================
# LOGGING CONFIGURATION
# ============================================
logging.level.pain_helper_back=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.apache.kafka=DEBUG
logging.level.pain_helper_back.security.JwtAuthenticationFilter=DEBUG